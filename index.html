<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>我的起始页</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --panel-bg: rgba(255,255,255,0.90);
      --main-color: #4f8cff;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      min-height: 100vh;
      background: #f6f8fa;
      position: relative;
      overflow-x: hidden;
    }
    #bgContainer {
      position: fixed;
      left: 0;top: 0;right: 0;bottom: 0;
      width: 100vw; height: 100vh;
      z-index: -1;
      overflow: hidden;
      background: #eee;
    }
    #bgImage, #bgVideo {
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      display: none;
      pointer-events: none;
      user-select: none;
    }
    .panel {
      background: var(--panel-bg);
      border-radius: 16px;
      box-shadow: 0 2px 16px rgba(0,0,0,.08);
      margin: 24px auto 0 auto;
      padding: 26px 28px;
      max-width: 420px;
      width: 96vw;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .weather {
      width: 100%;
      margin-bottom: 18px;
      text-align: center;
      font-size: 18px;
      color: #222;
    }
    .search-box {
      width: 100%;
      display: flex;
      margin-bottom: 20px;
    }
    .engine-select {
      border: none;
      padding: 6px 12px;
      border-radius: 9px;
      background: #f2f5fa;
      font-size: 15px;
      margin-right: 8px;
      outline: none;
    }
    .search-input {
      flex: 1;
      border: none;
      padding: 8px 0;
      font-size: 17px;
      outline: none;
      background: transparent;
      color: #222;
    }
    .search-btn {
      border: none;
      background: var(--main-color);
      color: #fff;
      border-radius: 99px;
      padding: 7px 18px;
      font-size: 15px;
      margin-left: 10px;
      cursor: pointer;
    }
    .bookmarks {
      width: 100%;
      margin-top: 15px;
    }
    .bookmark-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }
    .bookmark {
      background: #f2f5fa;
      border-radius: 8px;
      padding: 4px 12px;
      display: flex;
      align-items: center;
      color: #333;
      text-decoration: none;
      font-size: 15px;
      transition: background .15s;
    }
    .bookmark:hover {
      background: #cbe3ff;
    }
    .add-bookmark-btn {
      background: #eee;
      border: none;
      border-radius: 8px;
      padding: 4px 12px;
      margin-left: 4px;
      cursor: pointer;
      font-size: 15px;
    }
    .bg-tools {
      width: 100%;
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 14px;
      color: #666;
      align-items: center;
    }
    @media (max-width: 600px) {
      .panel { padding: 16px 4vw; }
      .search-box { flex-direction: column; }
      .search-btn { margin-left: 0; margin-top: 8px;}
      .engine-select { margin-bottom: 5px;}
    }
  </style>
</head>
<body>
  <div id="bgContainer">
    <img id="bgImage" />
    <video id="bgVideo" autoplay loop muted></video>
  </div>
  <div class="panel">
    <div class="weather" id="weatherBox">加载天气中...</div>
    <form class="search-box" id="searchForm" autocomplete="off">
      <select class="engine-select" id="engineSelect">
        <option value="https://www.google.com/search?q=%s">Google</option>
        <option value="https://www.bing.com/search?q=%s">Bing</option>
        <option value="https://www.baidu.com/s?wd=%s">百度</option>
        <option value="https://duckduckgo.com/?q=%s">DuckDuckGo</option>
      </select>
      <input class="search-input" id="searchInput" placeholder="搜索点什么吧..." autofocus>
      <button class="search-btn" type="submit">搜索</button>
    </form>
    <div class="bookmarks">
      <div style="font-weight:500;margin-bottom:8px;">书签</div>
      <div class="bookmark-list" id="bookmarkList"></div>
      <button class="add-bookmark-btn" onclick="openBookmarkDialog()">+ 添加书签</button>
    </div>
    <div class="bg-tools">
      <span>背景：</span>
      <select id="bgSource" onchange="switchBgSource()">
        <option value="bing">必应壁纸</option>
        <option value="custom-img">自定义图片</option>
        <option value="custom-video">自定义视频</option>
      </select>
      <input type="file" id="bgFile" style="display:none;" accept="image/*,video/mp4"/>
    </div>
  </div>
  <!-- 添加书签弹窗 -->
  <div id="bookmarkDialog" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.27);align-items:center;justify-content:center;z-index:100;">
    <div style="background:#fff;padding:18px 22px;border-radius:10px;max-width:90vw;">
      <div style="font-weight:500;">添加书签</div>
      <input id="bmName" placeholder="名称" style="margin-top:10px;width:100%;padding:5px 8px;font-size:15px;">
      <input id="bmUrl" placeholder="网址(需 https://)" style="margin-top:9px;width:100%;padding:5px 8px;font-size:15px;">
      <div style="text-align:right;margin-top:12px;">
        <button onclick="closeBookmarkDialog()" style="margin-right:10px;">取消</button>
        <button onclick="addBookmark()">保存</button>
      </div>
    </div>
  </div>
  <script>
    // 天气信息（OpenWeatherMap免费接口, 需填写自己的API KEY）
    async function loadWeather() {
      const weatherBox = document.getElementById('weatherBox');
      try {
        // 建议改为你所在城市, 或通过IP定位
        let city = localStorage.getItem('my_weather_city') || 'Beijing';
        let apiKey = '你的APIKEY'; // https://openweathermap.org/
        let res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&lang=zh_cn&appid=${apiKey}`);
        if (!res.ok) throw new Error('天气获取失败');
        let data = await res.json();
        let weather = data.weather[0].description;
        let temp = Math.round(data.main.temp);
        let name = data.name || city;
        weatherBox.innerHTML = `<span style="font-size:22px;">${name}</span> ${weather} <span style="color:var(--main-color);font-weight:bold;font-size:22px;margin-left:8px;">${temp}°C</span>`;
      } catch (e) {
        weatherBox.textContent = '无法获取天气，请检查API KEY。';
      }
    }
    loadWeather();

    // 搜索
    document.getElementById('searchForm').onsubmit = function(e) {
      e.preventDefault();
      const q = document.getElementById('searchInput').value.trim();
      if (!q) return;
      const engineUrl = document.getElementById('engineSelect').value;
      window.open(engineUrl.replace('%s', encodeURIComponent(q)), '_blank');
    };

    // 书签
    function getBookmarks() {
      try { return JSON.parse(localStorage.getItem('my_bookmarks')||'[]'); } catch { return []; }
    }
    function setBookmarks(arr) {
      localStorage.setItem('my_bookmarks', JSON.stringify(arr));
      renderBookmarks();
    }
    function renderBookmarks() {
      const list = document.getElementById('bookmarkList');
      list.innerHTML = '';
      let arr = getBookmarks();
      arr.forEach((bm,i) => {
        let a = document.createElement('a');
        a.className = 'bookmark';
        a.href = bm.url;
        a.target = '_blank';
        a.textContent = bm.name;
        a.title = bm.url;
        // 删除按钮
        let del = document.createElement('span');
        del.textContent = ' ×';
        del.style.cursor = 'pointer';
        del.style.marginLeft = '4px';
        del.style.color = '#aaa';
        del.onclick = function(e){e.preventDefault();arr.splice(i,1);setBookmarks(arr);};
        a.appendChild(del);
        list.appendChild(a);
      });
      if (!arr.length) list.innerHTML = '<span style="color:#aaa;font-size:13px;">暂无书签</span>';
    }
    renderBookmarks();

    // 添加书签弹窗
    function openBookmarkDialog() {
      document.getElementById('bookmarkDialog').style.display = 'flex';
      document.getElementById('bmName').value = '';
      document.getElementById('bmUrl').value = '';
    }
    function closeBookmarkDialog() {
      document.getElementById('bookmarkDialog').style.display = 'none';
    }
    function addBookmark() {
      let name = document.getElementById('bmName').value.trim();
      let url = document.getElementById('bmUrl').value.trim();
      if(!name || !url || !/^https?:\/\//.test(url)) {
        alert('请填写书签名称和正确的网址（以http/https开头）');
        return;
      }
      let arr = getBookmarks();
      arr.push({name,url});
      setBookmarks(arr);
      closeBookmarkDialog();
    }
    document.getElementById('bookmarkDialog').onclick = function(e) {
      if(e.target === this) closeBookmarkDialog();
    };

    // 背景图/视频
    function setBg(type, url) {
      const img = document.getElementById('bgImage');
      const vid = document.getElementById('bgVideo');
      if(type === 'custom-img' && url) {
        img.src = url; img.style.display = 'block'; vid.style.display='none';
      } else if(type === 'custom-video' && url) {
        vid.src = url; vid.style.display='block'; img.style.display = 'none';
      } else { // 必应壁纸
        img.src = 'https://www.todaybing.com/api'; img.style.display = 'block'; vid.style.display = 'none';
      }
    }
    function switchBgSource() {
      let type = document.getElementById('bgSource').value;
      let url = localStorage.getItem('my_bg_url');
      if(type === 'custom-img' || type === 'custom-video') {
        document.getElementById('bgFile').style.display = 'inline';
      } else {
        document.getElementById('bgFile').style.display = 'none';
        setBg('bing');
      }
      setBg(type, url);
    }
    document.getElementById('bgSource').onchange = switchBgSource;
    document.getElementById('bgFile').onchange = function(e){
      let file = e.target.files[0];
      if(!file) return;
      let url = URL.createObjectURL(file);
      let type = document.getElementById('bgSource').value;
      localStorage.setItem('my_bg_url', url);
      setBg(type, url);
    };
    // 初始化背景
    (() => {
      let type = localStorage.getItem('my_bg_type') || 'bing';
      document.getElementById('bgSource').value = type;
      let url = localStorage.getItem('my_bg_url');
      setBg(type, url);
    })();

    // 保存选择
    document.getElementById('bgSource').onchange = function(){
      let type = this.value;
      localStorage.setItem('my_bg_type', type);
      switchBgSource();
    };
  </script>
</body>
</html>
